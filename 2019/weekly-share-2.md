# 知识共享第2期
## Swift的Class的初始化器介绍
### 一、初始化器
初始化器在创建特定类型的实例时被调用，就像java的构造函数。在这个简单的形式中，使用 init 关键字来写：
```
class AClass {
  var a: Int
  init(n: Int){ 
    //初始化
    a = n
  }
}
//定义一个AClass类型的变量
var aclass = AClass(n: 3)
```
### 二、默认初始化器
对于所有属性都有默认值，且没有继承其他类的类，Swift会提供一个默认初始化器，如：
```
class Shape {
  var width = 1
  var height = 2
}

var aShape = Shape()
```
### 三、 指定初始化器和便捷初始化器
Swift的类的初始化器分为指定初始化器和便捷初始化器。一个类至少有一个指定初始化器和零个及以上的便捷初始化器  
指定初始化器：
 ```
 init(parameters) { statement }
 ```
 便捷初始化器：
 ```
 convenience init(parameters) { statement }
 ```
 ### 四、初始化器调用规则
 1. 规则一  
 > 指定初始化器必须从它的直系父类调用指定初始化器。
 2. 规则二  
 > 便捷初始化器必须从相同的类里调用另一个初始化器。
 3. 规则三  
 > 便捷初始化器最终必须调用一个指定初始化器。
 第二条和第三条规则的意思是，便捷初始化器可以调用另一个便捷初始化器或指定初始化器。若它只调用了一个便捷初始化器，则它调用的便捷初始化器一定调用了指定初始化器
### 五、初始化过程
> Swift 的类初始化是一个两段式过程。在第一个阶段，每一个存储属性被引入类分配了一个初始值。一旦每个存储属性的初始状态被确定，第二个阶段就开始了，每个类都有机会在新的实例准备使用之前来定制它的存储属性。  

为保证两段式的初始化过程，Swift编译器提供了四种安全检查  
安全检查 1    
> 指定初始化器必须保证在向上委托给父类初始化器之前，其所在类引入的所有属性都要初始化完成。  

安全检查 2  
> 指定初始化器必须先向上委托父类初始化器，然后才能为继承的属性设置新值。如果不这样做，指定初始化器赋予的新值将被父类中的初始化器所覆盖。  

安全检查 3  
> 便捷初始化器必须先委托同类中的其它初始化器，然后再为任意属性赋新值（包括同类里定义的属性）。如果没这么做，便捷构初始化器赋予的新值将被自己类中其它指定初始化器所覆盖。  

安全检查 4  
> 初始化器在第一阶段初始化完成之前，不能调用任何实例方法、不能读取任何实例属性的值，也不能引用 self 作为值。

简而言之，类的初始化过程是先初始化子类中的存储属性，再初始化父类的存储属性，最终由便捷初始化器做一些额外的工作，也可以没有便捷初始化器。
### 更详细内容可参考
[Swift初始化](https://www.cnswift.org/initialization)
